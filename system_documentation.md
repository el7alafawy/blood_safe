# توثيق نظام قطرة حياة للتبرع بالدم

## جدول المحتويات
1. [نظرة عامة](#نظرة-عامة)
2. [المتطلبات التقنية](#المتطلبات-التقنية)
3. [هيكل النظام](#هيكل-النظام)
4. [واجهات المستخدم](#واجهات-المستخدم)
5. [قواعد البيانات](#قواعد-البيانات)
6. [واجهات برمجة التطبيقات](#واجهات-برمجة-التطبيقات)
7. [الأمان والخصوصية](#الأمان-والخصوصية)
8. [دليل التثبيت](#دليل-التثبيت)
9. [دليل الاستخدام](#دليل-الاستخدام)

## نظرة عامة
نظام قطرة حياة هو منصة متكاملة لإدارة عمليات التبرع بالدم، تربط بين المتبرعين والمستشفيات والمحتاجين للدم. النظام مبني باستخدام أحدث التقنيات ويوفر واجهة مستخدم سهلة الاستخدام مع التركيز على الأمان والكفاءة.

### الأهداف الرئيسية
- تسهيل عملية التبرع بالدم
- ربط المتبرعين بالمحتاجين بشكل فعال
- إدارة مخزون الدم في المستشفيات
- توفير إحصائيات وتحليلات دقيقة
- ضمان أمان وخصوصية بيانات المستخدمين

## المتطلبات التقنية

### متطلبات الخادم
- Node.js v18.0.0 أو أحدث
- MongoDB v6.0 أو أحدث

### متطلبات العميل
- متصفح حديث يدعم JavaScript ES6+
- دعم HTTPS
- دعم WebSocket
- دعم Service Workers

### المكتبات والتقنيات المستخدمة
- Next.js 14
- React 18
- Tailwind CSS
- MongoDB Atlas
- JWT للتوثيق
- Socket.io للاتصال المباشر
- Chart.js للرسوم البيانية

## هيكل النظام

### المكونات الرئيسية
1. **واجهة المستخدم الأمامية**
   - صفحات الويب التفاعلية
   - تطبيق PWA للهواتف
   - لوحات التحكم المختلفة

2. **خادم الويب**
   - معالجة الطلبات
   - إدارة الجلسات
   - التخزين المؤقت

3. **قاعدة البيانات**
   - تخزين البيانات
   - النسخ الاحتياطي
   - التزامن

4. **خدمات الخلفية**
   - معالجة الإشعارات
   - إدارة المهام المجدولة
   - معالجة التقارير

### هيكل المجلدات
```
blood_safe/
├── src/
│   ├── app/
│   │   ├── components/
│   │   ├── context/
│   │   ├── services/
│   │   └── utils/
│   ├── lib/
│   └── styles/
├── public/
├── tests/
└── backend/
```

## واجهات المستخدم

### الصفحة الرئيسية
- **المكونات الرئيسية**
  - شريط التنقل العلوي
  - قسم الترحيب
  - إحصائيات النظام
  - أقسام المعلومات
  - نموذج البحث

- **التفاعلات**
  - تأثيرات التمرير
  - رسوم متحركة للإحصائيات
  - خريطة تفاعلية
  - نماذج الاتصال

### لوحة تحكم المستخدم
- **الأقسام الرئيسية**
  - لوحة المعلومات
  - إدارة التبرعات
  - الطلبات المتاحة
  - الملف الشخصي
  - الإشعارات

- **الميزات التفاعلية**
  - تحديثات في الوقت الفعلي
  - تصفية وبحث متقدم
  - تصدير التقارير
  - إدارة الإعدادات

### لوحة تحكم المستشفى
- **الأقسام الرئيسية**
  - إدارة المخزون
  - طلبات الدم
  - إدارة المتبرعين
  - التقارير والإحصائيات

- **الميزات المتقدمة**
  - تتبع المخزون
  - إدارة الطلبات
  - تحليل البيانات
  - إدارة المستخدمين

## قواعد البيانات

### هيكل قاعدة البيانات

#### مجموعة المستخدمين
```javascript
{
  _id: ObjectId,
  name: String,
  email: String,
  password: String (hashed),
  phone: String,
  address: {
    city: String,
    district: String,
    details: String
  },
  bloodType: String,
  role: String,
  status: String,
  lastDonation: Date,
  createdAt: Date,
  updatedAt: Date
}
```

#### مجموعة التبرعات
```javascript
{
  _id: ObjectId,
  donorId: ObjectId,
  hospitalId: ObjectId,
  bloodType: String,
  quantity: Number,
  status: String,
  donationDate: Date,
  expiryDate: Date,
  notes: String,
  createdAt: Date,
  updatedAt: Date
}
```

#### مجموعة طلبات الدم
```javascript
{
  _id: ObjectId,
  hospitalId: ObjectId,
  bloodType: String,
  quantity: Number,
  urgency: String,
  status: String,
  patientDetails: {
    name: String,
    age: Number,
    condition: String
  },
  location: {
    type: String,
    coordinates: [Number, Number]
  },
  createdAt: Date,
  updatedAt: Date
}
```

## واجهات برمجة التطبيقات

### نقاط النهاية الرئيسية

#### المستخدمين
```
GET    /api/users
POST   /api/users
GET    /api/users/:id
PUT    /api/users/:id
DELETE /api/users/:id
```

#### التبرعات
```
GET    /api/donations
POST   /api/donations
GET    /api/donations/:id
PUT    /api/donations/:id
DELETE /api/donations/:id
```

#### طلبات الدم
```
GET    /api/blood-requests
POST   /api/blood-requests
GET    /api/blood-requests/:id
PUT    /api/blood-requests/:id
DELETE /api/blood-requests/:id
```

### أمثلة على الطلبات

#### إنشاء مستخدم جديد
```javascript
POST /api/users
{
  "name": "اسم المستخدم",
  "email": "user@example.com",
  "password": "password123",
  "phone": "05xxxxxxxx",
  "address": {
    "city": "المدينة",
    "district": "الحي",
    "details": "تفاصيل العنوان"
  },
  "bloodType": "A+",
  "role": "user"
}
```

#### إنشاء طلب دم
```javascript
POST /api/blood-requests
{
  "hospitalId": "hospital_id",
  "bloodType": "O+",
  "quantity": 2,
  "urgency": "high",
  "patientDetails": {
    "name": "اسم المريض",
    "age": 30,
    "condition": "حالة المريض"
  },
  "location": {
    "type": "Point",
    "coordinates": [longitude, latitude]
  }
}
```

## الأمان والخصوصية

### إجراءات الأمان
- تشفير البيانات في حالة السكون
- تشفير البيانات في حالة النقل
- التحقق من صحة المدخلات
- حماية من هجمات XSS و CSRF
- تسجيل الأحداث الأمنية

### إدارة الجلسات
- استخدام JWT للتوثيق
- تجديد التوكن التلقائي
- إدارة الجلسات المتعددة
- تسجيل الخروج من جميع الأجهزة

### سياسة الخصوصية
- جمع البيانات الضرورية فقط
- موافقة المستخدم على جمع البيانات
- حق المستخدم في حذف بياناته
- حماية بيانات المرضى

## دليل التثبيت

### متطلبات ما قبل التثبيت
1. تثبيت Node.js
2. تثبيت MongoDB
4. إعداد متغيرات البيئة

### خطوات التثبيت
1. استنساخ المستودع
```bash
git clone https://github.com/your-repo/blood_safe.git
cd blood_safe
```

2. تثبيت التبعيات
```bash
npm install
```

3. إعداد ملف البيئة
```bash
cp .env.example .env
```

4. تشغيل التطبيق
```bash
npm run dev
```

## دليل الاستخدام

### للمستخدمين الجدد
1. إنشاء حساب جديد
2. إكمال الملف الشخصي
3. اختيار فصيلة الدم
4. تفعيل الإشعارات

### للمتبرعين
1. البحث عن طلبات الدم
2. اختيار طلب مناسب
3. تأكيد التبرع
4. متابعة حالة التبرع

### للمستشفيات
1. إدارة المخزون
2. إضافة طلبات جديدة
3. متابعة الطلبات
4. إصدار التقارير

### للمشرفين
1. إدارة المستخدمين
2. مراقبة النظام
3. إدارة المستشفيات
4. تحليل البيانات 